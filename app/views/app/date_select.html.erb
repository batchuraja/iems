<!DOCTYPE html>
<html>
  <head>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
    <script src='ChartNew.js'></script>
    <script src="http://code.highcharts.com/highcharts.js"></script>
    <script src="http://code.highcharts.com/modules/exporting.js"></script>
    <div id='iitgn-logo' style="position:absolute; top:10px; left:20px; z-index:1">
        <img src="http://upload.wikimedia.org/wikipedia/en/a/a2/IIT_Gandhinagar_Logo.svg" alt="IITGN Logo" height="100" width="100">
    </div>
  </head>

  <body onLoad="init()">
    <% if @label %>
      <script type="text/javascript">
        _labels =  "<%= @label %>"
        _labels = _labels.replace(/\&quot;/g, '').replace(/\[|]/g, "").split(',');
        window.onLoad = function() {
            init();
        };

        function init() {
          var ctx = $("#jan").get(0).getContext("2d");
          var data1 = {
            labels: _labels,
            datasets: [
              {
                fillColor : "rgba(29,158,171,0.6)",
                strokeColor : "rgba(37,116,168,1)",
                pointColor : "rgba(37,116,168,1)",
                pointStrokeColor : "rgba(255,255,255,1.00)",
                data: [3.9, 2.6, 1.8, 1.4, 1.2, 1.3, 1.5, 1.8, 2.8, 4.2, 5.2, 6.9, 7.5, 7.9, 7.8, 7.5, 7.6, 7.4, 6.8, 6.2, 4.9, 4.4, 4.0, 3.5]
              }
            ]
          }

          var data2 = {
            labels: _labels,
            datasets: [
              {
                fillColor: "rgba(188,66,69,0.49)",
                strokeColor: "rgba(204,46,59,1)",
                pointColor: "rgba(204,46,59,1)",
                pointStrokeColor: "rgba(255,255,255,1.00)",
                data: [2.8, 2.1, 1.6, 0.9, 0.8, 1.2, 1.0, 1.3, 2.0, 3.2, 4.6, 5.3, 5.4, 5.5, 5.4, 5.5, 5.5, 5.6, 5.4, 5.4, 5.3, 5.1, 4.5, 3.5]
              }
            ]
          } 

          var data3 = {
            labels: _labels,
            datasets: [
              {
                fillColor : "rgba(29,158,171,0.6)",
                strokeColor : "rgba(37,116,168,1)",
                pointColor : "rgba(37,116,168,1)",
                pointStrokeColor : "rgba(255,255,255,1.00)",
                data: [3.9, 2.6, 1.8, 1.4, 1.2, 1.3, 1.5, 1.8, 2.8, 4.2, 5.2, 6.9, 7.5, 7.9, 7.8, 7.5, 7.6, 7.4, 6.8, 6.2, 4.9, 4.4, 4.0, 3.5]
              },

              {
                fillColor: "rgba(188,66,69,0.49)",
                strokeColor: "rgba(204,46,59,1)",
                pointColor: "rgba(204,46,59,1)",
                pointStrokeColor: "rgba(255,255,255,1.00)",
                data: [2.8, 2.1, 1.6, 0.9, 0.8, 1.2, 1.0, 1.3, 2.0, 3.2, 4.6, 5.3, 5.4, 5.5, 5.4, 5.5, 5.5, 5.6, 5.4, 5.4, 5.3, 5.1, 4.5, 3.5]
              }
            ]
          } 

          var options = {
            canvasBackgroundColor:'rgba(255,255,255,1.00)',
            spaceLeft:10,
            spaceRight:10,
            spaceTop:10,
            spaceBottom:10,
            canvasBorders:true,
            canvasBordersWidth:2,
            canvasBordersColor:"rgba(204,46,59,0.8)",
            yAxisMinimumInterval:'none',
            scaleShowLabels:true,
            scaleShowLine:true,
            scaleLineWidth:1,
            scaleLineColor:"rgba(0,0,0,0.6)",
            scaleOverlay :false,
            scaleOverride :false,
            scaleSteps:10,
            scaleStepWidth:10,
            scaleStartValue:0,
            inGraphDataShow:true,
            inGraphDataFontFamily:"'Open Sans'",
            inGraphDataFontStyle:"normal bold",
            inGraphDataFontColor:"rgba(255,255,255,1.00)",
            inGraphDataFontSize:12,
            inGraphDataPaddingX:0,
            inGraphDataPaddingY:-5,
            inGraphDataAlign:"center",
            inGraphDataVAlign:"top",
            inGraphDataXPosition:2,
            inGraphDataYPosition:3,
            inGraphDataAnglePosition:2,
            inGraphDataRadiusPosition:2,
            inGraphDataRotate:0,
            inGraphDataPaddingAngle:0,
            inGraphDataPaddingRadius:0,
            legend:true,
            maxLegendCols:5,
            legendBlockSize:15,
            legendFillColor:'rgba(255,255,255,0.00)',
            legendColorIndicatorStrokeWidth:1,
            legendPosX:-2,
            legendPosY:4,
            legendXPadding:0,
            legendYPadding:0,
            legendBorders:false,
            legendBordersWidth:1,
            legendBordersColors:"rgba(102,102,102,1)",
            legendBordersSpaceBefore:5,
            legendBordersSpaceLeft:5,
            legendBordersSpaceRight:5,
            legendBordersSpaceAfter:5,
            legendSpaceBeforeText:5,
            legendSpaceLeftText:5,
            legendSpaceRightText:5,
            legendSpaceAfterText:5,
            legendSpaceBetweenBoxAndText:5,
            legendSpaceBetweenTextHorizontal:5,
            legendSpaceBetweenTextVertical:5,
            legendFontFamily:"'Open Sans'",
            legendFontStyle:"normal normal",
            legendFontColor:"rgba(0,0,0,1)",
            legendFontSize:15,
            showYAxisMin:false,
            rotateLabels:"smart",
            xAxisBottom:true,
            yAxisLeft:true,
            yAxisRight:false,
            graphTitleSpaceBefore:5,
            graphTitleSpaceAfter:5,
            graphTitle : "Load Profile",
            graphTitleFontFamily:"'Open Sans'",
            graphTitleFontStyle:"normal normal",
            graphTitleFontColor:"rgba(52,152,219,1)",
            graphTitleFontSize:26,
            /*graphSubTitleSpaceBefore:5,
            graphSubTitleSpaceAfter:5,
            graphSubTitle : "kW",
            graphSubTitleFontFamily:"'Open Sans'",
            graphSubTitleFontStyle:"normal normal",
            graphSubTitleFontColor:"rgba(102,102,102,1)",
            graphSubTitleFontSize:16,*/
            scaleFontFamily:"'Open Sans'",
            scaleFontStyle:"normal normal",
            scaleFontColor:"rgba(0,0,0,1)",
            scaleFontSize:12,
            pointLabelFontFamily:"'Open Sans'",
            pointLabelFontStyle:"normal normal",
            pointLabelFontColor:"rgba(102,102,102,1)",
            pointLabelFontSize:12,
            angleShowLineOut:true,
            angleLineWidth:1,
            angleLineColor:"rgba(0,0,0,0.1)",
            percentageInnerCutout:50,scaleShowGridLines:true,
            scaleGridLineWidth:1,
            scaleGridLineColor:"rgba(0,0,0,0.1)",
            scaleXGridLinesStep:1,
            scaleYGridLinesStep:1,
            segmentShowStroke:true,
            segmentStrokeWidth:2,
            segmentStrokeColor:"rgba(255,255,255,1.00)",
            datasetStroke:true,
            datasetFill : true,
            datasetStrokeWidth:2,
            bezierCurve:false,
            pointDotStrokeWidth : 1,
            pointDotRadius : 3,
            pointDot : true,
            pointDotMarker :"circle",
            barShowStroke : false,barBorderRadius:0,
            barStrokeWidth:1,
            barValueSpacing:15,
            barDatasetSpacing:0,
            scaleShowLabelBackdrop :true,
            scaleBackdropColor:'rgba(255,255,255,0.75)',
            scaleBackdropPaddingX :2,
            scaleBackdropPaddingY :2,
            animationEasing:'easeInCubic',
            animateRotate:true,
            animateScale:false,
            animationByDataset:false,
            animationLeftToRight:false,
            animationSteps:50,
            animation : true,
            xAxisFontFamily:"'Open Sans'",
            xAxisFontStyle:"normal normal",
            xAxisFontColor:"rgba(102,102,102,1)",
            xAxisFontSize:16,
            xAxisLabel : "Time",
            yAxisFontFamily:"'Open Sans'",
            yAxisFontStyle:"normal normal",
            yAxisFontColor:"rgba(102,102,102,1)",
            yAxisFontSize:16,
            yAxisLabel : "Instantaneous Power (kW)",
          }
/*
          if("<%=@tag1%>" == "Shed 1" && "<%=@tag2%>" == "Shed 1") {
          var myNewChart = new Chart(ctx).Line(data1, options);
          }

          else if("<%=@tag1%>" == "Shed 2" && "<%=@tag2%>" == "Shed 2") {
          var myNewChart = new Chart(ctx).Line(data2, options);
          }


          else if("<%=@tag1%>" == "Shed 1" && "<%=@tag2%>" == "Shed 2") {
          var myNewChart = new Chart(ctx).Line(data3, options);
          }*/
        }

        $(function () {
            $('#plot').highcharts({
                title: {
                    text: 'Load Profile',
                    x: -20 //center
                },
                xAxis: {
                    categories: _labels,
                    tickInterval: 1
                },
                yAxis: {
                    title: {
                        text: 'Instantaneous Power (kW)'
                    },
                    plotLines: [{
                        value: 0,
                        width: 1,
                        color: '#808080'
                    }]
                },
                tooltip: {
                    valueSuffix: 'Â°C'
                },
                legend: {
                    layout: 'vertical',
                    align: 'right',
                    verticalAlign: 'middle',
                    borderWidth: 0
                },
                series: [{
                    name: 'Shed 1',
                    data: [7.0, 6.9, 9.5, 14.5, 18.2, 21.5, 25.2, 26.5, 23.3, 18.3, 13.9, 9.6]
                }, {
                    name: 'Shed 2',
                    data: [-0.2, 0.8, 5.7, 11.3, 17.0, 22.0, 24.8, 24.1, 20.1, 14.1, 8.6, 2.5]
                }, {
                    name: 'Shed 3',
                    data: [-0.9, 0.6, 3.5, 8.4, 13.5, 17.0, 18.6, 17.9, 14.3, 9.0, 3.9, 1.0]
                }, {
                    name: 'Shed 4',
                    data: [3.9, 4.2, 5.7, 8.5, 11.9, 15.2, 17.0, 16.6, 14.2, 10.3, 6.6, 4.8]
                }]
            });
        });
      </script>

      <% end %>
      <h1 align = "center">Institute Energy Management System</h1>
      <h2 align = "center">Dashboard</h2>

      <div id='form' style="position:absolute; top:150px; left:60px; z-index:1">
        <table align="left" summary = "Plotter form fields" height="200" width= "500">
        <%= form_for( :query, :url => {:action => 'date_select'} ) do |f| %>
        <tr>
          <th align="left"><%= f.label(:building1, "Building 1") %></th>
          <td align="left"><%= f.select(:building1, @buildings.map {|b| [b.name]}) %></td>
        </tr>
        <tr>
        <tr>
          <th align="left"><%= f.label(:building2, "Building 2") %></th>
          <td align="left"><%= f.select(:building2, @buildings.map {|b| [b.name]}) %></td>
        </tr>
        <tr>
          <th align="left"><%= f.label(:parameter) %></th>
          <td align="left"><%= f.select(:parameter, ['Energy', 'Instantaneous Power', 'RMS Voltage', 'Line Frequency', 'Power Factor']) %></td>
        </tr>
        <tr>
          <th align="left"><%= f.label(:dateTime, "Select date and time") %></th>
          <td><%=datetime_select "dateTimeStart" ,"var1" %></td>
        </tr>
        <tr>
          <td></td>
          <td>to</td>
        </tr>
        <tr>
          <td></td>
          <td><%=datetime_select "dateTimeEnd" ,"var2" %></td>
        </tr>
        <tr>
          <td></td>
          <td><%= submit_tag("Submit") %></td>
        </table>
        <br>
      <% end %>
    </div>

    <div id='plot' style="position:absolute; top:120px; right:60px; z-index:1">
      <canvas align = "right" id="jan" height="450" width= "700" ></canvas>
    </div>

  </body>
</html>